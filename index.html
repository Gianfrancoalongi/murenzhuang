<!DOCTYPE html> 
<html>
  <head>    
    <script language="javascript" type="text/javascript" src="./jquery-1.9.1.min.js"></script>
    <script>
      var STDIN="STDIN";
      var STDOUT="STDOUT";

      var paths;
      var files;

      function initialize_paths_and_files()
      {
          files=[];
          paths=[];
          paths.push([STDIN,STDOUT])
      }

      function add_mutator_from_input()
      { 
           var mutator="mutator_"+Math.floor((Math.random()*100)+1);
           add_node_between(STDIN,mutator,STDOUT);
      }
  
      function add_output_node_from_input()
      {
           var output_file=create_new_output_file();
           add_node_from(STDIN,output_file);
      }

      function add_node_from(source,new_node)
      {
           paths.push([source,new_node]);
      }
 
      function add_node_between(source,new_node,end)
      {
           paths.push([source,new_node,end]);
      }

      function create_new_output_file()
      {
           var file_name=random_file_name();
           while( file_name_is_used(file_name) )
           {
               file_name=random_file_name();
           }
           files.push(file_name);
           return file_name;
      }

      function file_name_is_used(file_name)
      {
           return $.inArray(file_name, files) != -1
      }

      function random_file_name()
      {
           return "file_"+Math.floor((Math.random()*100)+1);
      }

      function create_dot_code_from_paths()
      {          
          var length = paths.length, element = null;
          var dot_paths=[];
          for (var i = 0; i < length; i++)
          {
              element = paths[i];
              var parts = element.length, subpart = null;
	      for (var j = 1; j < parts; j++)
              {
                  dot_paths.push(element[j-1]+"->"+element[j]);
              }
          }
          var dot_code="";
          var length = dot_paths.length, element = null;
          for (var i = 0; i < length; i++)
          {
              dot_code+=dot_paths[i]+";";
          }
          return dot_code;
      }

      function make_graphviz_graph()
      {              
          path_dot_code = create_dot_code_from_paths();
          dot_code = "digraph gr{ " + path_dot_code + " }";
          options = {cht: "gv", chl: dot_code };
          request = "https://chart.googleapis.com/chart?"+$.param(options);
          $('#graph_img').attr('src',request);
      }
    </script>
  </head>
  <body> 
    <img id="graph_img"/>
    <script> 
           initialize_paths_and_files();
           add_mutator_from_input();
           add_output_node_from_input();
           make_graphviz_graph();
    </script> 
  </body>
</html>
